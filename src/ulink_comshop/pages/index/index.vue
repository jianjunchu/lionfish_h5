<template>
  <div class="page" ref="page">
    <el-amap style="display: none" vid="amap" :plugin="plugin" class="amap-demo" :center="center">
    </el-amap>
    <div v-if="loadOver && isblack!=1" >

      <div  :class="['index-box', 'pb100', (showNewCoupon?'preventTouchMove':'')]">
        <div class="miniAppTip" v-if="isTipShow">
          <div @click="handleProxy" class="add-myapp">
            <span>{{$t('index.desktop')}}</span>
          </div>
        </div>
        <div @click="handleHideProxy" class="guide" v-if="isShowGuide">
          <img mode="widthFix" :src="index_lead_image"/>
        </div>
        <div class="bg-f" >
          <div class="header-content" v-if="hide_top_community==0">
            <img class="header-bg"
                 :src="shop_info.common_header_backgroundimage?shop_info.common_header_backgroundimage:'@/assets/images/TOP_background@2x.png'"
                 v-if="shop_info.index_top_img_bg_open==0"/>
            <div class="location" :style="{color:shop_info.index_top_font_color}"
                 v-if="shop_info.index_communityinfo_showtype!=1">
              <div class="location-left" v-if="community&&community.communityName">
                <router-link hoverClass="router-hover" to="/ulink_comshop/pages/position/community"
                             v-if="hide_community_change_btn==0&&open_danhead_model!=1">
                  <div class="community-title">
                                <span>{{community.communityName}}
                <span class="community-change" v-if="hide_community_change_word==0">{{$t('index.change')}}</span>
                                    <span class="iconfont icon-youjiantou"></span>
                                </span>
                  </div>
                </router-link>
                <div v-else>
                  <div class="community-title">
                    <span>{{community.communityName}}</span>
                  </div>
                </div>
                <div @click="gotoMap" class="community-address" v-if="index_hide_headdetail_address==0">
                  <span class="iconfont icon-weizhi-tianchong"></span>
                  {{community.address||community.communityAddress||community.fullAddress}}
                </div>
              </div>
              <div class="location-left" v-else>
                <router-link hoverClass="router-hover" to="/ulink_comshop/pages/position/community">
                  {{$t('index.not_choose')}}{{groupInfo.owner_name}}，{{ $t('index.to_choose')}}
                  <span class="iconfont icon-weizhi-tianchong"></span>
                </router-link>
              </div>
              <div class="location-right">
                <img class="img" :src="(community && community.headImg)?community.headImg:community.disUserHeadImg"/>
                <span>{{community.disUserName}}</span>
              </div>
            </div>
            <div class="location-theme2" :style="{color: shop_info.index_top_font_color}" v-else>
              <div v-if="community&&community.communityName">
                <div class="loc-l">
                  <img class="img" :src="(community&&community.headImg)?community.headImg:community.disUserHeadImg"/>
                </div>
                <div @click="goLink" class="loc-m" data-link="/ulink_comshop/pages/position/community"
                     v-if="hide_community_change_btn==0&&open_danhead_model!=1">
                  {{community.communityName}}
                  <span style="font-size:12px;" v-if="hide_community_change_word==0">切换</span>
                  <span class="iconfont icon-youjiantou" style="font-size:12px;"></span>
                </div>
                <div class="loc-m" v-else>{{community.communityName}}</div>
              </div>
              <div class="loc-l" v-else>
                <router-link class="router-hover" to="/ulink_comshop/pages/position/community">
                  您还没有选择{{groupInfo.owner_name}}，轻触去选择
                  <span class="iconfont icon-weizhi-tianchong"></span>
                </router-link>
              </div>
              <div @click="goLink" class="top-search" data-link="/ulink_comshop/pages/type/search">
                <span class="iconfont icon-sousuo1"></span>
                ${{$t('index.search')}}
              </div>
            </div>
          </div>

          <div class="index-search-bar" v-if="index_switch_search==1">
            <div class="search-box">
              <input @keypress="goResult" class="ipt" confirmType="搜索" :placeholder="$t('index.search')" type="search"
                     v-model="searchName"></input>
              <div class="search-icon">
                <div class="iconfont icon-sousuo1"></div>
              </div>
              <div class="search-icon2" @click="clearSearch">
                <img style="width: 5vw;height: 5vw;margin-top: 2vw"
                 src="@/assets/images/img-close.png"/>
              </div>
            </div>
          </div>

          <div class="swipe" v-if="slider_list.length>0">
            <swiper :options="sliderSwiperOption" class="swiper-content">
              <swiper-slide class="swiper-slide" v-for="(item,index) in slider_list" :key="index">
                <img @click.stop.prevent="swiperClick(item)" :src="item.image" class="show-img-index" width="100%"
                     height="100%" style="border-radius: 12px"/>
              </swiper-slide>
              <!-- 分页器 -->
              <div class="swiper-pagination" slot="pagination"></div>
            </swiper>
          </div>
          <div class="nav-list" v-if="navigat && navigat.length>0">
            <div v-for="(item,idx) in navigat" style="width:25%;" class="block" :key="item.id">
              <div @click="goNavUrl" class="nav-list-item" :data-idx="idx" v-if="item.type!=5">
                <img class="nav-list-img" :src="item.thumb"/>
                <div class="nav-list-text"><span v-if="$i18n.locale == 'en'">{{item.navname_en}}</span><span v-else>{{item.navname}}</span></div>
              </div>
              <button class="nav-list-item nav-contact" openType="contact" v-else>

                <img class="nav-list-img" :src="item.thumb"/>
                <div class="nav-list-text"><span v-if="$i18n.locale == 'en'">{{item.navname_en}}</span><span v-else>{{item.navname}}</span></div>
              </button>
            </div>
            <div style="width:25%;" v-if="navigatEmpty &&navigatEmpty.length" v-for="(item,id) in navigatEmpty"></div>
          </div>
          <div class="promotion" v-if="hasCoupon">
            <div class="slider">
              <div class="slider-wraper">
                <div class="list">
                  <div @click="receiveCoupon" class="card-content list-item" :data-quan_id="item.id"
                       v-for="(item,index) in quan" :key="item.id">
                    <div class="card">
                      <div class="card-price span">
                        <div class="card-price unit span">¥</div>
                        <div class="card-price num span">{{item.credit}}</div>
                      </div>
                      <div class="card-desc span" v-if="item.limit_money>0">
                        满{{item.limit_money}}元可用
                      </div>
                      <div class="card-desc span" v-else>
                        全场通用
                      </div>
                      <div :class="[card-tag, span, {'card-tag&#45;&#45;get':item.is_get==1}]">
                        <div class="card-tag text span">已领取</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>


          <div style="padding-bottom:5px;margin-left: 16px;margin-right: 16px" v-if="notice_list && notice_list.length>0">
            <div class="top-msg" :style="{color:skin.color,background:skin.lighter}">
              <img :src="notice_setting.horn" v-if="notice_setting.horn"/>
              <span class="iconfont icon-laba" v-else></span>

              <svg-icon icon-class="laba" v-else/>

              <swiper :options="skinSwiperOption" class="notice-swipe">
                <swiper-slide class="notice-swipe-item" v-for="(item,index) in notice_list" :key="index">
                  {{item.content}}
                </swiper-slide>
              </swiper>


            </div>
          </div>

          <!--限时抢购开始-->

          <template is="cube" :data="{data:cube}"></template>

          <div class="cube" v-if="cube && cube.length">
            <div v-for="(item,index) in cube" :key="item.id">
              <div class="cube-item" v-if="item.type==1">
                <img @click.native="goCube" class="cube-one rounded" data-idx="0" :data-index="index" mode="widthFix"
                     :src="item.thumb.cover[0]"></img>
              </div>
              <div class="cube-item" v-if="item.type==2">
                <i-img @click.native="goCube" data-idx="0" :data-index="index" height="59vw" iClass="cube-left rounded"
                       :loadImage="item.thumb.cover[0]" width="50vw"></i-img>
                <i-img @click.native="goCube" data-idx="1" :data-index="index" height="59vw" iClass="cube-two rounded"
                       :loadImage="item.thumb.cover[1]" width="59vw"></i-img>
              </div>
              <div class="cube-item" v-if="item.type==3">
                <i-img @click.native="goCube" data-idx="0" :data-index="index" height="59vw" iClass="cube-left rounded"
                       :loadImage="item.thumb.cover[0]" width="33vw"></i-img>
                <div class="i-flex-col i-flex-spb">
                  <i-img @click.native="goCube" data-idx="1" :data-index="index" height="29vw"
                         iClass="cube-three rounded" :loadImage="item.thumb.cover[1]" width="60vw"></i-img>
                  <i-img @click.native="goCube" data-idx="2" :data-index="index" height="29vw"
                         iClass="cube-three rounded" :loadImage="item.thumb.cover[2]" width="60vw"></i-img>
                </div>
              </div>
              <div class="cube-item" v-if="item.type==4">
                <i-img @click.native="goCube" data-idx="0" :data-index="index" height="59vw" iClass="cube-left rounded"
                       :loadImage="item.thumb.cover[0]" width="33vw"></i-img>
                <div class="i-flex-col i-flex-spb">
                  <i-img @click.native="goCube" data-idx="1" :data-index="index" height="29vw"
                         iClass="cube-three rounded" :loadImage="item.thumb.cover[1]" width="60vw"></i-img>
                  <div class="i-flex i-flex-spb w450">
                    <i-img @click.native="goCube" data-idx="2" :data-index="index" height="29vw"
                           iClass="cube-four rounded" :loadImage="item.thumb.cover[2]" width="29.5vw"></i-img>
                    <i-img @click.native="goCube" data-idx="3" :data-index="index" height="29vw"
                           iClass="cube-four rounded" :loadImage="item.thumb.cover[3]" width="29.5vw"></i-img>
                  </div>
                </div>
              </div>
              <div class="cube-item" v-if="item.type==5">
                <img @click.native="goCube" class="cube-w" :data-idx="idx" :data-index="index" mode="widthFix"
                     :src="imgItem" v-for="(imgItem,idx) in item.thumb.cover" :key="idx"></img>
              </div>
              <div class="cube-item" v-if="item.type==6">
                <img @click.native="goCube" class="cube-w" :data-idx="idx" :data-index="index" mode="widthFix"
                     :src="imgItem" v-for="(imgItem,idx) in item.thumb.cover" :key="idx"></img>
              </div>
              <div class="cube-item" v-if="item.type==7">
                <img @click.native="goCube" class="cube-w" :data-idx="idx" :data-index="index" mode="widthFix"
                     :src="imgItem" v-for="(imgItem,idx) in item.thumb.cover" :key="idx"></img>
              </div>
              <div class="cube-item two-row" v-if="item.type==8">
                <img @click.native="goCube" class="cube-w" :data-idx="idx" :data-index="index" mode="widthFix"
                     :src="imgItem" v-for="(imgItem,idx) in item.thumb.cover" :key="idx"></img>
              </div>
            </div>
          </div>

          <!--限时抢购结束-->

          <!-- 附近店铺 -->
          <div class="index_supply" v-if="supply.length>0 && enabledFrontSupply==1">
            <div class="my-supply">
              <div class="supply-title">
                <span class="leftBorder" :style="{'border-color':skin.color}"></span>
                {{$t('home.fujindianpu')}}
              </div>
              <router-link class="to-supply" to="/ulink_comshop/pages/supply/index1">
                <span>{{$t('home.gengduo')}}</span>
                <img class="icon-right" src="@/assets/images/rightArrowImg.png"/>
              </router-link>
            </div>
            <div class="supply-list" v-if="supply.length>0">
              <div class="supply-list-item" v-for="(item,index) in supply" :key="item.id" @click="goSupply" :data-id="item.id">
                <div class="supply-list-distance">{{item.distance}}KM</div>
                <img class="supply-list-img" :src="item.logo"/>
                <div class="supply-list-text">{{item.storename || item.shopname}}</div>
              </div>
            </div>
          </div>

        </div>


        <div class="list-content">

          <i-new-comer @openSku="openSku" :refresh="newComerRefresh" :skin="skin"
                       v-if="is_show_new_buy==1"></i-new-comer>

          <!--<template is="pin" :data="{pinList:pinList,skin:skin}"></template>-->


          <i-spike @openSku="openSku" :refresh="newComerRefresh" :skin="skin" v-if="is_show_spike_buy==1"></i-spike>


          <!--<template is="seckill"
                    :data="{secRushList:secRushList,skin:skin,scekillTimeList:scekillTimeList,secKillActiveIdx:secKillActiveIdx,secKillGoodsIndex:secKillGoodsIndex,needAuth:needAuth}"
                    v-if="seckill_is_open==1&&seckill_is_show_index==1"></template>-->

          <!--整点秒杀开始-->
          <div class="seckill" v-if="seckill_is_open==1&&seckill_is_show_index==1">
            <div class="seckill-head i-flex" :style="{background:skin.color}">
              <div class="tit">
                <div>整点</div>
                <div>秒杀</div>
              </div>
              <div class="i-flex-item i-flex">
                <div @click="changeSecKillTime" :class="['seckill-head-item' ,secKillActiveIdx==index?'active':'']"
                     :data-idx="index" :data-time="item.seckillTime" v-for="(item,index) in scekillTimeList"
                     :key="item.id">
                  <div class="time">{{item.timeStr}}</div>
                  <div class="desc" :style="secKillActiveIdx==index?'color:'+skin.color:''">{{item.desc}}</div>
                </div>
              </div>
              <div @click="goLink" class="more"
                   :data-link="'/ulink_comshop/moduleA/seckill/list?time='+scekillTimeList[secKillActiveIdx].seckillTime">
                更多 <span class="iconfont icon-gengduo"></span>
              </div>
            </div>
            <div class="seckill-list" v-if="secRushList && secRushList.length">

              <swiper :options="sliderSwiperOption" class="sec-swiper-content">
                <swiper-slide v-for="(item,index) in secRushList" :key="item.id">
                  <i-seckill-spu :begin="scekillTimeList[currentTab].state==2?1:0" :needAuth="needAuth" :skin="skin"
                                 :spuItem="item"></i-seckill-spu>
                </swiper-slide>
              </swiper>

              <van-swipe class="my-swipe" :autoplay="3000" :indicator-color="skin.color">
                <van-swipe-item v-for="(item,index) in secRushList" :key="item.id">
                  <i-seckill-spu :begin="scekillTimeList[currentTab].state==2?1:0" :needAuth="needAuth" :skin="skin"
                                 :spuItem="item"></i-seckill-spu>
                </van-swipe-item>
              </van-swipe>


              <span class="current" v-if="secRushList && secRushList.length">{{secKillGoodsIndex}}/{{secRushList.length}}</span>
            </div>
          </div>
          <!--整点秒杀结束-->


          <i-topic @openSku="openSku" :refresh="couponRefresh"></i-topic>
          <div class="theme3 bg-f" v-if="typeTopicList && typeTopicList.length&&(typeItem.banner||typeItem.list.length)"
               v-for="(typeItem,index) in typeTopicList" :key="typeItem.id">
            <img @click="goLink" class="topic-img" :data-link="'/ulink_comshop/pages/type/details?id='+typeItem.id"
                 mode="widthFix" :src="typeItem.banner" v-if="typeItem.banner"/>
            <i-rush-spu @authModal="authModal" @changeCartNum="changeNotListCartNum" @openSku="openSku"
                        :canLevelBuy="{canLevelBuy}" class="item" :is_open_vipcard_buy="is_open_vipcard_buy"
                        :needAuth="needAuth" :notNum="true" :reduction="reduction" :spuItem="item"
                        :stopClick="stopClick" v-if="typeItem.list && typeItem.list.length"></i-rush-spu>
            <div @click="goLink" class="theme3-more"
                 :data-link="'/ulink_comshop/pages/type/details?id='+typeItem.id" v-if="typeItem.list.length">
              All
              <span class="iconfont icon-youjiantou"></span>
            </div>
          </div>
          <template is="pinrow" :data="{pinList:pinList,skin:skin}"></template>
          <!--
                    <img class="rush-list-title" id="rush-title" :src="shop_info.index_list_top_image"
                         v-if="shop_info.index_list_top_image"/>

                    <img class="rush-list-title" id="rush-title" src="@/assets/images/rush-title.png" v-else/>
          -->


          <div v-if="hide_index_type!=1">
            <div class="sticky-cate_index" v-if="index_change_cate_btn==1">
              <div v-show="isShowClassification && tabIdx ==0">
                <van-sticky :offset-top="48">
                  <!--<i-tabs :activeIndex="classification.activeIndex" @activeIndexChange="classificationChange"
                          data-idx="1" fontColor="#000" iClass="category-list" :tabs="classification.tabs"></i-tabs>-->

                  <van-tabs v-model="classification.activeIndex" @click="classificationChange">
                    <van-tab v-for="(item , index) in classification.tabs" :title="item.name_en || item.name"
                             :title-style="{'flex-basis':'auto','padding': '0 10px'}">
                    </van-tab>
                  </van-tabs>
                </van-sticky>
              </div>
              <div class="tab-nav-index-query"></div>
            </div>

            <div
              :class="['sticky-content-index', {'sticky-top':isSticky, 'tab-nav-index-sticky':scrollDirect == 'up'&&isSticky }]"
              v-else>
              <div class="tab-nav-index tab-nav-index-query" :style="{'border-color':skin.color}">
                <div @click="tabSwitch('0')" :class="['tab-nav-index-item', (tabIdx==0?'active':'')]" data-idx="0">
                  <img
                    :src="(qgtab.one_select ? qgtab.one_select : require('@/assets/images/index-tab-left-active.png'))"
                    v-if="tabIdx==0"/>
                  <img
                    :src="(qgtab.one_selected?qgtab.one_selected:require('@/assets/images/index-tab-left-disabled.png'))"
                    v-else/>
                  <span>{{index_qgtab_text[0]?index_qgtab_text[0]:$t('index.buying')}}</span>
                </div>
                <div @click="tabSwitch('1')" :class="['tab-nav-index-item', (tabIdx==1?'active':'')]" data-idx="1">
                  <img :src="(qgtab.two_select?qgtab.two_select:require('@/assets/images/index-tab-right-active.png'))"
                       v-if="tabIdx==1"/>
                  <img
                    :src="(qgtab.two_selected?qgtab.two_selected:require('@/assets/images/index-tab-right-disabled.png'))"
                    v-else/>
                  <span>{{index_qgtab_text[1]?index_qgtab_text[1]: $t('index.to_buy')}}
            </span>
                </div>
                <div class="count-down-content" v-if="tabIdx==0">
                  <i-count-down :clearTimer="stopNotify" countdownClass="count-down" itemClass="item-time"
                                showDay="true" :target="rushEndTime"
                                v-if="rushEndTime && !stopNotify && index_qgtab_counttime!=1">
                    <span class="count-down-left-text">{{$t('home.jinsheng')}}</span>
                  </i-count-down>
                </div>
              </div>
              <div v-show="isShowClassification && tabIdx==0">
                <van-sticky :offset-top="48">
                  <!--<i-tabs :activeIndex="classification.activeIndex" @activeIndexChange="classificationChange"
                          data-idx="1" fontColor="#000" class="category-list" :tabs="classification.tabs"></i-tabs>-->
                  <van-tabs v-model="classification.activeIndex" data-idx="1" @click="classificationChange">
                    <van-tab v-for="(item , index) in classification.tabs" :title="$i18n.locale == 'en' ? item.name_en:item.name"
                             :title-style="{'flex-basis':'auto','padding': '0 10px'}">
                    </van-tab>
                  </van-tabs>
                </van-sticky>
              </div>
              <div v-show="isShowCommingClassification && tabIdx==1">
                <van-sticky :offset-top="50">
                  <!--<i-tabs :activeIndex="commingClassification.activeIndex" @activeIndexChange="classificationChange" data-idx="2" fontColor="#000"
                          iClass="category-list" :tabs="classification.tabs"></i-tabs>-->

                  <van-tabs v-model="commingClassification.activeIndex" data-idx="2"  @click="commingClassificationChange">
                    <van-tab v-for="(item , index) in classification.tabs" :title="$i18n.locale == 'en' ? item.name_en:item.name"
                             :title-style="{'flex-basis':'auto','padding': '0 10px'}">
                    </van-tab>
                  </van-tabs>
                </van-sticky>
              </div>
            </div>
          </div>


          <div v-if="tabIdx==0">

            <van-list v-model="$data.$data.isLoadData" :finished="commigLoadMore" ref="pullRefresh" @load="load_goods_data" class="rush-list-box">

              <div class="active-item" v-if="rushList && rushList.length>0&&theme==0" v-for="(item,index) in rushList"
                   :key="item.id">
                <div class="list-item-tag-content" v-if="isShowListTimer==1">
                  <div class="empty-1"></div>
                  <div class="empty-2" v-if="item.spuDescribe"></div>
                  <div class="empty-3"></div>
                  <div class="list-item-count-down" :data-xx="item.spuCanBuyNum" :style="{color:skin.color}"
                       v-if="item.spuCanBuyNum!=0&&!actEndMap[item.end_time]">
                    仅剩
                    <em v-if="countDownMap[item.end_time].day>0">{{countDownMap[item.end_time].day}}天</em>
                    <span class="item-class">{{countDownMap[item.end_time].hour}}</span>:
                    <span class="item-class">{{countDownMap[item.end_time].minute}}</span>:
                    <span class="item-class">{{countDownMap[item.end_time].second}}</span>
                  </div>
                </div>

                <i-new-rush-spu :actEnd="actEndMap[item.end_time]" @authModal="authModal" @changeCartNum="changeCartNum"
                                @openSku="openSku" @vipModal="vipModal" :canLevelBuy="canLevelBuy"
                                :changeCarCount="changeCarCount" :isShowListCount="isShowListCount"
                                :isShowListTimer="isShowListTimer==1" :is_open_vipcard_buy="is_open_vipcard_buy"
                                :needAuth="needAuth" :reduction="reduction" :showPickTime="(ishow_index_pickup_time==1)"
                                :skin="skin" :spuItem="item" :stopClick="stopClick" :enabledFrontSupply="enabledFrontSupply"></i-new-rush-spu>

              </div>
              <div class="active-item-two" v-if="rushList && rushList.length>0&&theme==1" v-for="(item,index) in rushList"
                   :key="item.id">
                <div class="list-item-tag-content" v-if="isShowListTimer==1">
                  <div class="list-item-count-down type-two" :style="{color:skin.color}"
                       v-if="item.spuCanBuyNum!=0&&!actEndMap[item.end_time]">
                    Time Left
                    <em v-if="countDownMap[item.end_time].day>0">{{countDownMap[item.end_time].day}}&nbsp;Day</em>
                    <span class="item-class">{{countDownMap[item.end_time].hour}}</span>:
                    <span class="item-class">{{countDownMap[item.end_time].minute}}</span>:
                    <span class="item-class">{{countDownMap[item.end_time].second}}</span>
                  </div>
                </div>
                <i-rush-spu-big :actEnd="actEndMap[item.end_time]" @authModal="authModal" @changeCartNum="changeCartNum"
                                @openSku="openSku" @vipModal="vipModal" :canLevelBuy="canLevelBuy"
                                :changeCarCount="changeCarCount" :isShowListCount="isShowListCount"
                                :is_open_vipcard_buy="is_open_vipcard_buy" :needAuth="needAuth" :reduction="reduction"
                                :showPickTime="ishow_index_pickup_time==1" :skin="skin" :spuItem="item"
                                :stopClick="stopClick"></i-rush-spu-big>
              </div>
              <div class="theme3" v-if="rushList.length>0&&theme==2">
                <img @click="goLink" class="topic-img"
                     :data-link="'/ulink_comshop/pages/type/details?id='+classificationId" mode="widthFix"
                     :src="cate_info.banner" v-if="cate_info.banner"/>


                <i-rush-spu @authModal="authModal" @changeCartNum="changeCartNum" @openSku="openSku"
                            @vipModal="vipModal" :canLevelBuy="canLevelBuy" :changeCarCount="changeCarCount"
                            class="item" :is_open_vipcard_buy="is_open_vipcard_buy" :needAuth="needAuth"
                            :reduction="reduction" :spuItem="item" :stopClick="stopClick"
                            v-for="(item,index) in rushList" :key="item.actId"></i-rush-spu>

              </div>
              <!--<i-load-more iClass="loadMore" :loading="loadMore" :tip="loadText" v-if="loadMore"></i-load-more>-->

              <div class="none-rush-list" v-if="showEmpty">
                <img class="img-block" src="@/assets/images/icon-index-empty.png"/>
                <div class="h1">Please try again</div>
                <!-- <div class="h2">我们正在为您准备更优惠的团购</div> -->
              </div>
              <!--
                            <div class="slogan" v-if="!loadMore&&rushList.length">
                              <img :src="(indexBottomImage?indexBottomImage:require('@/assets/images/icon-index-slogan.png'))"/>
                            </div>
              -->
            </van-list>
          </div>

          <div v-if="tabIdx == 1">

            <van-list v-model="$data.$data.isLoadData" :finished="commigLoadMore" @load="getCommingList"
                      class="rush-list-box">

            <div class="comming-list" v-if="commingList && commingList.length">
              <!--<i-comming-spu :category="commingClassification.tabs[commingClassification.activeIndex].name"
                             class="comming-spu-item" :spuItem="item" v-if="commingList.length"
                             v-for="(item,index) in commingList"></i-comming-spu>-->


              <div class="active-item" v-if="rushList && rushList.length>0&&theme==0" v-for="(item,index) in commingList"
                   :key="item.id">

                <i-new-rush-spu :actEnd="actEndMap[item.end_time]" @authModal="authModal" @changeCartNum="changeCartNum"
                                @openSku="openSku" @vipModal="vipModal" :canLevelBuy="canLevelBuy"
                                :changeCarCount="changeCarCount" :isShowListCount="isShowListCount"
                                :isShowListTimer="isShowListTimer==1" :is_open_vipcard_buy="is_open_vipcard_buy"
                                :needAuth="needAuth" :reduction="reduction" :showPickTime="(ishow_index_pickup_time==1)"
                                :skin="skin" :spuItem="item" :stopClick="stopClick" :enabledFrontSupply="enabledFrontSupply"></i-new-rush-spu>

              </div>

            </div>
            <div class="none-rush-list" v-if="showCommingEmpty">
              <img class="img-block" src="@/assets/images/icon-index-empty.png"/>
              <div class="h1">Please try again</div>
              <div class="h2"></div>
            </div>
            <!--
                          <div class="slogan" v-if="!commigLoadMore&&commingList.length">
                            <img :src="(indexBottomImage?indexBottomImage:require('@/assets/images/icon-index-slogan.png'))"/>
                          </div>
            -->
            </van-list>
          </div>

        </div>
        <div @click="showCopyTextHandle" class="copytext-btn" :data-status="true" v-if="ishow_index_copy_text==1">
          一键复制拼团信息
        </div>
        <div class="fixed-aside">
          <button @click="share_handler" class="fixed-service" v-if="isShowShareBtn==1">
            <span class="iconfont icon-fenxiang"></span>
            <div>Share</div>
          </button>
          <button class="fixed-service" openType="contact" v-if="isShowContactBtn==1">
            <span class="iconfont icon-kefu"></span>
            <div>Service</div>
          </button>
          <button @click="backTop"class="fixed-service" v-show="(!isSticky)" v-if="ishow_index_gotop==1">
            <span class="iconfont icon-fanhuidingbu"></span>
            <div>Top</div>
          </button>
        </div>

        <i-tabbar ref="tabbar" @authModal="authModal" :cartNum="cartNum" :currentIdx="0" :needAuth="needAuth"
                  :tabbarRefresh="tabbarRefresh"></i-tabbar>

        <i-order-notify iClass="order-notify" :stopNotify="stopNotify"
                        v-if="shop_info.order_notify_switch==1"></i-order-notify>
        <i-change-community @changeComunity="confrimChangeCommunity" :canChange="hide_community_change_btn==0"
                            :changeCommunity="changeCommunity" :community="community" :groupInfo="groupInfo"
                            :visible="showChangeCommunity"></i-change-community>

        <div class="new-coupou" v-if="showCouponModal&&hasAlertCoupon&&!showChangeCommunity">
          <div class="new-coupou-content">
            <div class="new-coupou-body">
              <div class="new-coupou-body-head">Welcome to H&Z Mart!
                <!--Here's ${{totalAlertMoney}} for use on your first purchase.--></div>
              <div class="new-coupou-body-scroll">
                <div scrollY style="max-height:580px;">
                  <div class="new-coupou-item" v-for="(item ,index) in alert_quan_list" :key="item.id">
                    <div class="m-coupon-l">
                      <div class="m-coupou-price">
                        <span>$</span>
                        {{item.credit}}
                      </div>
                    </div>
                    <div class="m-coupou-m">
                      <div class="m-coupou-name">{{item.voucher_title}}</div>
                      <div class="m-coupou-title" v-if="item.limit_money>0">min ${{item.limit_money}} purchase to use
                        coupon
                      </div>
                      <div class="m-coupou-title" v-else>Useable for all products</div>
                    </div>
                    <div class="m-coupou-r">
                      <div @click="goUse" class="new-coupou-use kong" :data-idx="index">Use</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="new-coupou-body-foot">
                <div @click="toggleCoupon" class="new-coupou-body-btn" data-auth="true">Use Now</div>
              </div>
            </div>
            <div class="new-coupou-foot">
              <span @click="toggleCoupon" class="iconfont icon-guanbi"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="forbid i-flex-col i-flex-alc" v-if="isblack==1">
      <span class="iconfont icon-icon-test1"></span>
      <div class="h1">您已被禁止访问</div>
      <div class="h2">请联系管理员</div>
    </div>
    <div class="mask" v-if="visible"></div>
    <div cancel="close" class="sku-content" v-if="visible" scrollUp="true">
      <div class="sku-card">
        <div @click="closeSku" class="close">
          <img src="@/assets/images/icon-sku-close.png"/>
        </div>
        <div class="sku-header">

          <van-image class="sku-img" :src="cur_sku_arr.skuImage">
            <template v-slot:loading>
              <van-loading type="spinner" size="20"/>
            </template>
          </van-image>


          <div class="sku-desc">
            <div class="sku-title">
              <span>{{cur_sku_arr.spuName}}</span>
            </div>
            <div class="sku-price">
              <div class="sale-price">
                ¥ <span>{{cur_sku_arr.actPrice[0]}}</span>.{{cur_sku_arr.actPrice[1]}}
              </div>
              <div class="market-price">¥{{cur_sku_arr.marketPrice[0]}}.{{cur_sku_arr.marketPrice[1]}}</div>
              <i-vip-price :price="cur_sku_arr.card_price"
                           v-if="is_open_vipcard_buy==1&&is_vip_card_member==1&&is_take_vipcard==1"></i-vip-price>
              <div v-else-if="is_member_level_buy==1&&is_mb_level_buy==1">
                <i-vip-price :price="cur_sku_arr.levelprice" type="1"
                             v-if="is_open_vipcard_buy==1&&is_vip_card_member!=1"></i-vip-price>
                <i-vip-price :price="cur_sku_arr.levelprice" type="1" v-if="is_open_vipcard_buy!=1"></i-vip-price>
              </div>
            </div>
            <div class="sku-switch-on" v-if="cur_sku_arr.spec">已选择：{{cur_sku_arr.spec}}</div>
          </div>
        </div>
        <div class="sku-spec" v-for="(item,index) in skuList.list">
          <div class="title">{{item.name}}</div>
          <div class="spec-list">
            <span @click="selectSku" :data-sku="sku[index].idx" :class="idx==sku[index].idx?'on':''"
                  :data-disabled="(item.canBuyNum-valitem)<0"
                  :data-idx="idx" :data-type="index + '_' + idx + '_' + valitem.option_value_id + '_' + valitem.name"
                  v-for="(valitem, idx) in item.option_value" :key="idx">{{valitem.name}}</span>
          </div>
        </div>
        <div class="sku-num-content">
          <div class="title">Quantity</div>
          <div :class="['i-class', 'i-input-number', 'i-input-number-size-']">
            <div @click.stop="setNum" :class="['i-input-number-minus']"
                 data-type="decrease">
              <img src="@/assets/images/icon-input-reduce.png"></image>
            </div>
            <input bindblur="handleBlur" bindfocus="handleFocus" @input="changeNumber"
                   :class="['i-input-number-text']" type="number"
                   v-model="sku_val"/>
            <div @click.stop="setNum" :class="['i-input-number-plus']"
                 data-type="add">
              <img src="@/assets/images/icon-input-add.png"></image>
            </div>
          </div>
          <!--&lt;!&ndash;<div class="msg" v-if="current && skuList[current] && skuList[current].isLimit">
            <span v-if="skuList[current].limitMemberNum>-1">每人限{{skuList[current].limitMemberNum}}单</span>
            <span v-if="skuList[current].limitOrderNum>-1">每单限{{skuList[current].limitOrderNum}}份</span>
            <span></span>
          </div>&ndash;&gt;
          &lt;!&ndash;<div class="even-num" v-elif="!skuList[current].isLimit&&skuList[current].canBuyNum_value<=10&&skuList[current].canBuyNum_value>-1">
            还可以购买 {{skuList[current].canBuyNum-value}} 件
          </div>&ndash;&gt;-->
        </div>
        <button @click.stop="gocarfrom" class="sku-confirm" :disabled="(cur_sku_arr.stock==0?true:false)" formType="submit">
          <div>{{cur_sku_arr.stock==0?$t('home.yiqiangguang'):$t('home.queding')}}</div>
        </button>
      </div>
    </div>
    <div @click="is_share_html = false" class="ui-mask" v-show="is_share_html"></div>
    <div class="model-services show" v-show="is_share_html">
      <div class="model-services-title">{{$t('common.fenxiang')}}</div>
      <div class="model-services-content">
        <div class="service-list">
          <div class="service-item">
            <div class="none_btn" @click="share_whatsapp" openType="share" plain="true">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="39" height="39" viewBox="0 0 39 39"><path fill="#00E676"
                                                                                                         d="M10.7 32.8l.6.3c2.5 1.5 5.3 2.2 8.1 2.2 8.8 0 16-7.2 16-16 0-4.2-1.7-8.3-4.7-11.3s-7-4.7-11.3-4.7c-8.8 0-16 7.2-15.9 16.1 0 3 .9 5.9 2.4 8.4l.4.6-1.6 5.9 6-1.5z"></path><path
                  fill="#FFF"
                  d="M32.4 6.4C29 2.9 24.3 1 19.5 1 9.3 1 1.1 9.3 1.2 19.4c0 3.2.9 6.3 2.4 9.1L1 38l9.7-2.5c2.7 1.5 5.7 2.2 8.7 2.2 10.1 0 18.3-8.3 18.3-18.4 0-4.9-1.9-9.5-5.3-12.9zM19.5 34.6c-2.7 0-5.4-.7-7.7-2.1l-.6-.3-5.8 1.5L6.9 28l-.4-.6c-4.4-7.1-2.3-16.5 4.9-20.9s16.5-2.3 20.9 4.9 2.3 16.5-4.9 20.9c-2.3 1.5-5.1 2.3-7.9 2.3zm8.8-11.1l-1.1-.5s-1.6-.7-2.6-1.2c-.1 0-.2-.1-.3-.1-.3 0-.5.1-.7.2 0 0-.1.1-1.5 1.7-.1.2-.3.3-.5.3h-.1c-.1 0-.3-.1-.4-.2l-.5-.2c-1.1-.5-2.1-1.1-2.9-1.9-.2-.2-.5-.4-.7-.6-.7-.7-1.4-1.5-1.9-2.4l-.1-.2c-.1-.1-.1-.2-.2-.4 0-.2 0-.4.1-.5 0 0 .4-.5.7-.8.2-.2.3-.5.5-.7.2-.3.3-.7.2-1-.1-.5-1.3-3.2-1.6-3.8-.2-.3-.4-.4-.7-.5h-1.1c-.2 0-.4.1-.6.1l-.1.1c-.2.1-.4.3-.6.4-.2.2-.3.4-.5.6-.7.9-1.1 2-1.1 3.1 0 .8.2 1.6.5 2.3l.1.3c.9 1.9 2.1 3.6 3.7 5.1l.4.4c.3.3.6.5.8.8 2.1 1.8 4.5 3.1 7.2 3.8.3.1.7.1 1 .2h1c.5 0 1.1-.2 1.5-.4.3-.2.5-.2.7-.4l.2-.2c.2-.2.4-.3.6-.5s.4-.4.5-.6c.2-.4.3-.9.4-1.4v-.7s-.1-.1-.3-.2z"></path></svg>

              </span>
              <div class="cube-text">
                <span>{{$t('common.haoyou')}}</span>
              </div>
            </div>
          </div>
          <!--<div @click="goLink" class="service-item" data-link="/ulink_comshop/pages/index/share"
               :data-needauth="true">
            <span class="iconfont icon-pengyouquan service-icon"></span>
            <div class="cube-text">
              <span>海报</span>
            </div>
          </div>-->
        </div>
      </div>
    </div>
    <i-modal :scrollUp="false" v-show="showCopyText">
      <div class="copytext">
        <div class="copytext-title">
          - 团长信息 -
          <span @click="showCopyTextHandle" class="iconfont icon-guanbi copytext-close" :data-status="false"></span>
        </div>
        <div class="copytext-p">小区：{{community.communityName}}</div>
        <div class="copytext-p">团长：{{community.disUserName}}</div>
        <div class="copytext-p">自提点：{{community.address||community.communityAddress||community.fullAddress}}</div>
        <div class="copytext-h3">今日推荐</div>
        <div scrollY class="copytext-content">
          <div class="copytext-item" v-if="copy_text_arr && copy_text_arr.length" v-for="(item,index) in copy_text_arr">
            {{index+1}}. 【{{item.goods_name}}】
            <span>团购价{{item.price}}元</span>
          </div>
        </div>
        <i-button @click="copyText" class="community-content-btn" iClass="btn">一键复制</i-button>
      </div>
    </i-modal>
    <i-new-auth @authSuccess="authSuccess" @cancel="authModal" :needAuth="needAuth&&showAuthModal"
                :needPosition="needPosition"></i-new-auth>
    <i-vip-modal :imgUrl="pop_vipmember_buyimage" :visible="showVipModal"></i-vip-modal>
    <!--<div class="mp-account" v-if="show_index_wechat_oa==1">
      <official-account binderror="binderror" bindload="bindload"></official-account>
    </div>-->


  </div>
</template>


<script>
  import GlobalMixin from '../../mixin/globalMixin.js'
  import { Search, Sticky, Swipe, SwipeItem } from 'vant'
  import util from '../../utils/index.js'
  import status from '../../utils/index.js'
  import a from '../../utils/public'
  import countDownInit from '../../utils/countDown'

  var _Page, _extends = Object.assign || function(t) {
    for (var a = 1; a < arguments.length; a++) {
      var e = arguments[a]
      for (var o in e) Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o])
    }
    return t
  }

  function _defineProperty(t, a, e) {
    return a in t ? Object.defineProperty(t, a, {
      value: e,
      enumerable: !0,
      configurable: !0,
      writable: !0
    }) : t[a] = e, t
  }

  var wcache = require('../../utils/wcache.js'), wx, app

  export default {
    mixins: [countDownInit, GlobalMixin],
    name: 'Index',
    components: { [Sticky.name]: Sticky, [Swipe.name]: Swipe, [SwipeItem.name]: SwipeItem, [Search.name]: Search },
    data() {
      let self = this
      return {
        pageScroll: 0,
        searchName: '',
        sliderSwiperOption: {
          //显示分页
          pagination: {
            el: '.swiper-pagination'
          },
          //设置点击箭头
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev'
          },
          //自动轮播
          autoplay: {
            delay: 2000,
            //当用户滑动图片后继续自动轮播
            disableOnInteraction: false
          },
          //开启循环模式
          loop: true
        },
        skinSwiperOption: {
          notNextTick: true,
          direction: 'vertical',   //控制滚动的方向
          paginationClickable: true,
          autoplay: {
            delay: 2000  //这里需要注意，如果想每2秒去自动切换，直接autoplay:2000是失效的，
          },
          loop: true

        },
        tpage: 1,
        loadMore: !0,
        ishow_index_copy_text: 0,
        ishow_index_gotop: 0,
        hide_community_change_btn: 0,
        isShowShareBtn: 0,
        isShowContactBtn: 0,
        stopClick: !1,
        showAuthModal: !1,
        changeCarCount: !1,
        community: {
          communityAddress: undefined,
          communityId: undefined,
          communityName: undefined,
          disUserHeadImg: undefined,
          disUserName: undefined,
          fullAddress: undefined,
          headImg: undefined,
          head_mobile: undefined,
          lat: undefined,
          lon: undefined
        },
        rushList: [],
        commingList: [],
        countDownMap: [],
        actEndMap: [],
        skuList: [],
        pageNum: 1,
        notice_list: [],
        slider_list: [],
        shop_info: {},
        showEmpty: !1,
        indexBottomImage: '',
        classification: {
          tabs: [],
          activeIndex: -1
        },
        commingClassification: {
          tabs: [],
          activeIndex: -1
        },
        needAuth: !1,
        isShowCommingClassification: !0,
        isShowClassification: !0,
        showChangeCommunity: !1,
        isTipShow: !1,
        isShowGuide: !1,
        index_lead_image: '',
        theme: 0,
        cartNum: 0,
        navigat: [],
        tabIdx: 0,
        scrollDirect: '',
        isSticky: !1,
        showCommingEmpty: !1,
        stopNotify: !0,
        reduction: {},
        is_share_html: false,
        commingNum: 0,
        couponRefresh: !1,
        index_change_cate_btn: 0,
        newComerRefresh: !1,
        showCouponModal: !1,
        copy_text_arr: [],
        showCopyText: !0,
        totalAlertMoney: 0,
        groupInfo: {
          group_name: '社区',
          owner_name: '团长'
        },
        needPosition: !0,
        typeTopicList: [],
        pinList: {},
        cube: [],
        secRushList: [],
        secKillGoodsIndex: 1,
        isblack: 0,
        imageSize: {
          imageWidth: '100%',
          imageHeight: 600
        },
        fmShow: !0,
        cur_sku_arr: {
          stock: 0,
          actPrice: [],
          marketPrice: []
        },
        sku: [],
        index_list_top_image: 1,
        is_open_vipcard_buy: true,
        is_member_level_buy: true,
        is_show_new_buy: true,
        is_show_spike_buy: true,
        current: 0,
        size: '',
        sku_val: '',
        showNewCoupon: '',
        hide_top_community: '',
        hasCoupon: '',
        seckill_is_open: true,
        seckill_is_show_index: 1,
        index_switch_search: 1,
        hide_index_type: 0,
        index_qgtab_text: '',
        qgtab: {},
        rushEndTime: true,
        pop_vipmember_buyimage: '',
        showVipModal: false,
        hide_share_handler: false,
        is_mb_level_buy: false,
        is_vip_card_member: false,
        is_mb_level_buy: false,
        visible: !1,
        changeCommunity: {},
        loadOver: !1,
        loadText: 'Loading...',
        commigLoadMore: false,
        enabledFrontSupply: 0,
        $data: {
          stickyFlag: !1,
          scrollTop: 0,
          overPageNum: 1,
          loadOver: !1,
          hasOverGoods: !1,
          countDownMap: {},
          actEndMap: {},
          timer: {},
          scrollHeight: 1300,
          stickyTop: 0,
          hasCommingGoods: !0
        },
        center: [121.59996, 31.197646],
        plugin: [{
          pName: 'Geolocation',
          events: {
            init(o) {
              // o 是高德地图定位插件实例
              o.getCurrentPosition((status, result) => {
                console.log(result)
                if (result && result.position) {

                  self.$wx.setStorageSync('position', result.position)
                  self.$wx.setStorage({
                    key: 'latitude',
                    data: result.position.lat
                  })
                  self.$wx.setStorage({
                    key: 'longitude',
                    data: result.position.lng
                  })
                  self.$nextTick()
                }
              })
            }
          }
        }],
        supply: []
      }
    },
    watch: {
      $route: {
        handler: function(route) {
          this.redirect = route.query && route.query.redirect
        },
        immediate: true
      }
    },
    created: function() {
      app = this.$getApp();
      wx = this.$wx;

      wx.setNavigationBarTitle({
        title: this.shop_info.shoname,
        logo: this.shop_info.logo,
        showLogo: true,
        showMore: false,
        showBack: false
      })


      this.$data.$data.scrollTop = 0;
      const o = this.$route.query || {}
      this.onLoad(o)
    },
    mounted: function() {
      var i = this

    },
    activated: function() {
      var i = this
      var g = i.groupInfo

      if (this.$refs.tabbar) {
        i.$refs.tabbar.switchTab()
      }

      this.onShow()
      this.$refs.page.scrollTop = this.$data.$data.scrollTop
    },
    beforeRouteEnter(to, from, next) {
      next(vm => {

      })
    },
    beforeRouteLeave(to, from, next) {
      this.$data.$data.scrollTop = this.$refs.page.scrollTop;

      next()
    },
    methods: {

      copyText: function(t) {

      },
      onLoad: function(o) {
        var i = this, s = wx.getStorageSync('token')

        wx.getLogManager(), console.log('options', o), wx.hideTabBar()
        status.setNavBgColor(), status.setGroupInfo().then(function(t) {
          i.groupInfo = t
        }), console.log('step1')

        const n = wx.getStorageSync('community'),
          d = n && n.communityId ? n.communityId : ''
        if (n && n.fullAddress && n.fullAddress.indexOf('境外') > -1) {
          n.fullAddress = n.fullAddress.replace('境外境外境外地区', '')
        }

        if (o && 0 != Object.keys(o).length) {
          console.log('step2')
          var t = decodeURIComponent(o.scene);
            var e = wcache.get('share_id', null);
          if ('undefined' != t && e == null) {
            var a = t.split('_')
            o.community_id = a[0]
          }

            var oid = wcache.get('share_id', null);
            if (oid == null || oid=='' || oid==undefined) {
                'undefined' != (i.options = o).share_id && 0 < o.share_id && wcache.put('share_id', o.share_id);
            }


            'undefined' != o.community_id && 0 < o.community_id ? (console.log('step3'), util.getCommunityById(o.community_id).then(function(t) {
              if (0 == t.code) {
                console.log('step4')
                var a = t.data
                console.log('分享community_id', o.community_id), console.log('历史community_id', d)
                var e = {}
                1 == t.open_danhead_model ? (console.log('开启单社区' + t.default_head_info), this.community = t.default_head_info,
                  i.open_danhead_model = t.open_danhead_model, s && i.addhistory(t.default_head_info.communityId || '')) : a && (o.community_id != d ? d ? (i.showChangeCommunity = !0,
                  i.changeCommunity = a, this.community = n) : (i.community = a, i.shareCommunity = a,
                  wcache.put('community', a)) : i.community = n), i.hidetip = !1, i.token = s, i.showEmpty = !1,
                  e.needPosition = !1
                i.loadPage()
              } else {
                console.log('step5')
                i.loadPage()
                i.hidetip = !1
                i.token = s
                i.showEmpty = !1
                i.needPosition = !1
                s && i.addhistory()
              }
            })) : util.getCommunityById(o.community_id).then(function(t) {
              0 == t.code && (1 == t.open_danhead_model && (console.log('开启单社区step6'),
                i.community = t.default_head_info, i.open_danhead_model = t.open_danhead_model, s && i.addhistory(t.default_head_info.communityId || '')), console.log('step6'),
                i.loadPage())
            }).catch(function() {
              i.loadPage()
            })
        } else {
          util.getCommunityById(d).then(function(t) {
            0 == t.code && (1 == t.open_danhead_model && (console.log('开启单社区step7'), i.community = t.default_head_info, i.open_danhead_model = t.open_danhead_model
              , s && i.addhistory(t.default_head_info.communityId || '')), i.loadPage())
          }).catch(function() {
            i.loadPage()
          }), console.log('step7'), i.hidetip = !1, i.token = s, i.showEmpty = !1, i.community = n

        }
      },
      onShow: function() {

        var a = this,
          e = this
        util.check_login_new().then(function(t) {
          t ? (a.needAuth = !1 , status.cartNum().then(t => {
            a.cartNum = t.data
          })) : (a.needAuth = !0, a.couponRefresh = !1)
        })
        a.get_index_info()
        a.addhistory()
          a.getSupplyList();
          a.getNavigat();
        if ((a.stopNotify = !1, a.tabbarRefresh = !0, a.isblack = a.$app.globalData.isblack || 0), a.$app.globalData.timer.start(), a.$app.globalData.changedCommunity) {

          a.$app.globalData.goodsListCarCount = []
          var t = a.$app.globalData.community
          a.community = e.fliterCommunity(t)
          a.newComerRefresh = !1
          a.getCommunityPos(t.communityId)
          a.hasRefeshin = !1
          a.newComerRefresh = !0
          a.rushList = []
          a.pageNum = 1
          a.classificationId = null
          /*this.setData({

            "classification.activeIndex": -1
          }, function() {
            a.setData({
              "classification.activeIndex": 0
            });
          })*/
          a.$set(a.$data.$data, 'overPageNum', 1)
          a.$set(a.$data.$data, 'loadOver', !1)
          a.$set(a.$data.$data, 'hasOverGoods', !1)
          a.$set(a.$data.$data, 'countDownMap', {})
          a.$set(a.$data.$data, 'actEndMap', {})
          a.$set(a.$data.$data, 'timer', {})
          a.$set(a.$data.$data, 'stickyFlag', !1)
          a.$set(a.$data.$data, 'hasCommingGoods', !0)

          a.$app.globalData.changedCommunity = !1

          a.get_type_topic()
        } else {
          console.log('nochange')
          if (1 <= e.isFirst) {
            a.loadOver = !0
            this.changeRushListNum()
          }

          0 == e.isFirst ? a.couponRefresh = !0 : (this.getCoupon(), e.isFirst++)
        }


      },
      get_index_info() {
        var F = this,
          t = wx.getStorageSync('community'),
          B = t && (t.communityId || ''),
          a = wx.getStorageSync('token')

        F.$http({
          controller: 'index.index_info',
          communityId: B,
          token: a
        }).then(t => {
          var a = t,
            e = F.groupInfo
          if (0 == a.code) {
            if (!t.is_community && !F.needAuth) {
              var o = F.changeCommunity || {}

              if (o.communityId && o.communityId != '') {
                wcache.put('community', o)
                F.addhistory(o.community_id)
                F.community = o
                F.showChangeCommunity = !1
                F.loadPage()
              } else {

                wx.showModal({
                  title: '',
                  content: F.$t('index.qingxuanzeyigezitidian'),
                  showCancel: false,
                  confirmColor: '#8ED9D1',
                  success: function(t) {
                    wx.navigateTo({
                      url: '/ulink_comshop/pages/position/community'
                    })
                  }
                })
              }
            }
            var i = a.notice_list,
              s = a.slider_list,
              n = a.index_lead_image
            n ? status.getInNum().then(function(t) {
              t && (
                F.isTipShow = !0,
                  timerOut = setTimeout(function() {
                    F.isTipShow = !1
                  }, 9e3)
              )
            }) : (F.isTipShow = !1)
            var d = a.common_header_backgroundimage
            F.$getApp().globalData.common_header_backgroundimage = d
            var c = a.order_notify_switch,
              l = a.index_list_top_image_on || 1,
              r = a.index_change_cate_btn || 0,
              u = require('@/assets/images/rush-title.png')
            1 == l && (u = '')
            var h = a.index_list_top_image ? a.index_list_top_image : u,
              m = {
                shoname: a.shoname,
                logo: a.shoplogo_h5,
                shop_index_share_image: a.shop_index_share_image,
                index_list_top_image: h,
                title: a.title,
                common_header_backgroundimage: d,
                order_notify_switch: c,
                index_top_img_bg_open: a.index_top_img_bg_open || 0,
                index_top_font_color: a.index_top_font_color || '#fff',
                index_communityinfo_showtype: a.index_communityinfo_showtype || 0
              }
            F.$getApp().globalData.placeholdeImg = a.index_loading_image || ''
            var g = a.index_loading_image || ''
            wcache.put('shopname', a.shoname), wx.setNavigationBarTitle({
              title: a.shoname,
              logo: a.shoplogo_h5,
              showLogo: true,
              showMore: false,
              showBack: false
            })
            var p = a.category_list || [],
              _ = a.index_type_first_name || 'All'
            0 < p.length ? (p.unshift({
              name: _,
              id: 0
            }), (
              F.isShowClassification = !0,
                F.classification.tabs = p
            )) : (F.isShowClassification = !1)
            var f = a.theme || 0,
              y = 1e3 * a.rushtime || 0,
              w = a.index_share_switch || 0,
              x = a.is_show_list_count || 0,
              v = a.is_show_list_timer || 0,
              D = a.index_service_switch || 0,
              b = a.index_switch_search || 0,
              k = a.ishow_index_gotop || 0
            1 != a.is_comunity_rest || F.needAuth || wx.showModal({
              title: '温馨提示',
              content: e.owner_name + '休息中，欢迎下次光临!',
              showCancel: !1,
              confirmColor: '#8ED9D1',
              confirmText: '好的',
              success: function(t) {
              }
            }), F.postion = a.postion
            var T = a.scekill_time_arr || [],
              C = a.seckill_bg_color,
              S = a.seckill_is_open,
              L = a.seckill_is_show_index,
              I = a.hide_community_change_word,
              $ = a.index_qgtab_counttime,
              N = a.hide_index_type,
              M = new Date().getHours()
            console.log('当前时间:', M)
            var O = 0,
              P = []
            if (3 < T.length) {
              var R = T.length
              O = T.findIndex(function(t) {
                return M <= t
              }), console.log('当前时间索引:', O), P = -1 == O ? T.slice(-3) : 0 == O ? T.slice(0, 3) : O + 1 == R ? T.slice(-3) : T.slice(O - 1, O + 2)
            } else {
              P = T
            }
            var j = [],
              q = 0
            P.length && (P.forEach(function(t, a) {
              var e = {}
              t == M ? (e.state = 1, e.desc = '疯抢中', q = a) : t < M ? (e.state = 0, e.desc = '已开抢') : (e.state = 2,
                e.desc = '即将开抢'), e.timeStr = (t < 10 ? '0' + t : t) + ':00', e.seckillTime = t,
                j.push(e)
            }), F.getSecKillGoods(P[q]))
            var A = a.index_video_arr

            F.notice_list = i
            F.slider_list = s
            F.index_lead_image = n
            F.theme = f
            F.indexBottomImage = a.index_bottom_image || ''
            F.shop_info = m
            F.loadOver = !0
            F.rushEndTime = y
            F.commingNum = a.comming_goods_total
            F.isShowShareBtn = w
            F.isShowListCount = x
            F.isShowListTimer = v
            F.is_comunity_rest = a.is_comunity_rest
            F.index_change_cate_btn = r
            F.isShowContactBtn = D
            F.index_switch_search = b
            F.is_show_new_buy = a.is_show_new_buy || 0
            F.qgtab = t.qgtab || {}
            F.notice_setting = a.notice_setting || {}
            F.index_hide_headdetail_address = a.index_hide_headdetail_address || 0
            F.is_show_spike_buy = a.is_show_spike_buy || 0
            F.hide_community_change_btn = a.hide_community_change_btn || 0
            F.hide_top_community = a.hide_top_community || 0
            F.index_qgtab_text = a.index_qgtab_text
            F.ishow_index_copy_text = a.ishow_index_copy_text || 0
            F.newComerRefresh = !0
            F.cube = a.cube
            F.placeholdeImg = g
            F.seckill_bg_color = C
            F.seckill_is_open = S
            F.seckill_is_show_index = L
            F.scekillTimeList = j
            F.secKillActiveIdx = q
            F.hide_community_change_word = I
            F.ishow_index_gotop = k
            F.ishow_index_pickup_time = a.ishow_index_pickup_time || 0
            F.index_video_arr = A
            F.index_qgtab_counttime = $
            F.hide_index_type = N
            F.show_index_wechat_oa = a.show_index_wechat_oa

          }

        })
      },
      getSecKillGoods: function(t) {
        var e = this,
          a = wx.getStorageSync('community'),
          o = wx.getStorageSync('token')

        e.$http({
          controller: 'index.load_gps_goodslist',
          token: o,
          pageNum: 1,
          head_id: a.communityId,
          seckill_time: t,
          is_seckill: 1,
          per_page: 1e4
        }).then(t => {
          if (0 == t.code) {
            var a = t.list || []
            r.secRushList = a
          }
        })
      },
      goUse: function(t) {
        this.showCouponModal = !1
        this.hasAlertCoupon = !1
        var a = t.currentTarget.dataset.idx,
          e = this.alert_quan_list || []
        if (console.log(Object.keys(e).length), Object.keys(e).length >= a) {
          if (0 == e[a].is_limit_goods_buy) {
            wx.switchTab({
              url: '/ulink_comshop/pages/index/index'
            })
          } else if (1 == e[a].is_limit_goods_buy) {
            var o = e[a].limit_goods_list,
              i = ''
            i = 1 < o.split(',').length ? '/ulink_comshop/pages/type/result?type=2&good_ids=' + o : '/ulink_comshop/pages/goods/goodsDetail?id=' + o,
              wx.navigateTo({
                url: i
              })
          } else if (2 == e[a].is_limit_goods_buy) {
            var s = e[a].goodscates || 0
            wx.navigateTo({
              url: '/ulink_comshop/pages/type/result?type=1&gid=' + s
            })
          }
        }
      },
      get_type_topic: function() {
        var e = this,
          t = wx.getStorageSync('community') || {}

        e.$http({
          controller: 'goods.get_category_col_list',
          head_id: t.communityId
        }).then(t => {
          if (0 == t.code) {
            var a = t.data || []
            this.typeTopicList = a
          }
        })
      },
      toggleCoupon: function(t) {
        var a = t.currentTarget.dataset.auth || '';
        (this.needAuth || '') && a ? (
          this.showAuthModal = !0,
            this.showCouponModal = !1
        ) : (
          this.showCouponModal = !this.showCouponModal,
            this.hasAlertCoupon = !1
        )
      },
      getCoupon: function() {
        var n = this,
          t = wx.getStorageSync('token')
        app.util.request({
          url: 'entry/wxapp/index',
          data: {
            controller: 'goods.get_seller_quan',
            token: t
          },
          dataType: 'json',
          success: function(t) {
            var a = t.quan_list,
              e = !1,
              o = !1
            '[object Object]' == Object.prototype.toString.call(a) && 0 < Object.keys(a).length && (e = !0),
            '[object Array]' == Object.prototype.toString.call(a) && 0 < a.length && (e = !0)
            var i = t.alert_quan_list || []
            '[object Object]' == Object.prototype.toString.call(i) && 0 < Object.keys(i).length && (o = !0),
            '[object Array]' == Object.prototype.toString.call(i) && 0 < i.length && (o = !0)
            var s = 0
            '[object Object]' == Object.prototype.toString.call(i) && 0 < Object.keys(i).length ? Object.keys(i).forEach(function(t) {
              s += 1 * i[t].credit
            }) : '[object Array]' == Object.prototype.toString.call(i) && 0 < i.length && i.forEach(function(t) {
              s += 1 * t.credit
            }), (
              n.quan = t.quan_list || [],
                n.alert_quan_list = i,
                n.hasCoupon = e,
                n.hasAlertCoupon = o,
                n.showCouponModal = o,
                n.totalAlertMoney = s.toFixed(2)
            )
          }
        })

      }, getPinList: function() {
        var d = this,
          t = wx.getStorageSync('community').communityId || ''

        d.$http({
          controller: 'group.get_pintuan_list',
          is_index: 1,
          head_id: t
        }).then(t => {

          if (0 == t.code) {
            var a = {},
              e = t,
              o = e.list,
              i = e.pintuan_index_coming_img,
              s = e.pintuan_index_show,
              n = e.pintuan_index_show_listtop
            a.list = o || [], a.img = i || '', a.show = s || 0, a.showRow = n || 0
            this.pinList = a
          }
        })

      },

      addhistory: function() {
        var a = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 0
        console.log('step13')
        var t = 0
        0 == a ? t = wx.getStorageSync('community').communityId : t = a
        console.log('history community_id=' + t)
        var e = wx.getStorageSync('token'),
          o = this
        void 0 !== t && this.$http({
          controller: 'index.addhistory_community',
          community_id: t,
          token: e
        }).then(a => {
          0 != a && (o.getHistoryCommunity(), console.log('addhistory+id', a))
        })
      },
      loadPage() {

        var e = this
        e.get_index_info(), e.get_type_topic(), e.getNavigat(), e.getCoupon(), e.getPinList(), e.getSupplyList(), e.getCopyright(),
          status.loadStatus().then(function() {
            var t = e.$app.globalData.appLoadStatus

            if (console.log('appLoadStatus' + t), 0 == t) {
              setTimeout(function() {
                wx.hideLoading()
              }, 1e3)
              e.needAuth = !0
              e.couponRefresh = !1
              e.load_goods_data()
            } else if (2 == t) {
              console.log('step9'), e.getHistoryCommunity()
            } else {
              console.log('step12')
              var a = wx.getStorageSync('community');
              (a || (a = e.$app.globalData.community), a) ? (e.community = e.fliterCommunity(a)) :
                util.getCommunityInfo().then(function(t) {
                  e.community = e.fliterCommunity(t)
                }), console.log('step18'), e.load_goods_data()
            }
          })
      },
      load_goods_data: function() {
        var t = wx.getStorageSync('token'),
          m = this,
          a = wx.getStorageSync('community'),
          e = m.classificationId
        this.$data.$data.isLoadData = !0, console.log('load_goods_begin '), m.hasRefeshin || m.$data.$data.loadOver ? m.load_over_gps_goodslist() : (console.log('load_goods_in '),
          this.hasRefeshin = !0, (
          m.loadMore = !0
        ), app.util.request({
          url: 'entry/wxapp/index',
          data: {
            controller: 'index.load_gps_goodslist',
            token: t,
            pageNum: m.pageNum,
            head_id: a.communityId,
            gid: e,
            per_page: 12
          },
          dataType: 'json',
          success: function(t) {

            m.$data.$data.isLoadData = !1, setTimeout(function() {
              wx.hideLoading()
            }, 1e3)

            if (1 == m.pageNum && (
              m.cate_info = t.cate_info || {}
            ), 0 == t.code) {
              var a = ''
              if (1 == t.is_show_list_timer) {
                for (var e in a = m.transTime(t.list),
                  m.$data.$data.countDownMap) {
                  m.initCountDown(m.$data.$data.countDownMap[e])
                }
              } else {
                var o = m.rushList
                a = o.concat(t.list)
              }
              var i = t,
                s = i.full_money,
                n = i.full_reducemoney,
                d = i.is_open_fullreduction,
                c = i.is_open_vipcard_buy,
                l = i.is_vip_card_member,
                r = i.is_member_level_buy,
                u = {
                  full_money: s,
                  full_reducemoney: n,
                  is_open_fullreduction: d
                },
                h = !1
              1 == c ? 1 != l && 1 == r && (h = !0) : 1 == r && (h = !0), 1 == m.pageNum && (
                m.copy_text_arr = i.copy_text_arr || []
              ), m.hasRefeshin = !1, (
                m.rushList = a,
                  m.pageNum = m.pageNum + 1,
                  m.loadMore = !1,
                  m.reduction = u,
                  m.tip = '',
                  m.is_open_vipcard_buy = c || 0,
                  m.is_vip_card_member = l,
                  m.is_member_level_buy = r,
                  m.canLevelBuy = h
                /*}, function() {
                  1 == m.isFirst && (m.isFirst++, a.length && !m.$data.$data.stickyTop && (wx.createSelectorQuery().select(".tab-nav-query").boundingClientRect(function(t) {
                    if (t && t.top) wcache.put("tabPos", t), m.$data.$data.stickyTop = t.top + t.height, m.$data.$data.stickyBackTop = t.top;
                    else {
                      var a = wcache.get("tabPos", !1);
                      a && (m.$data.$data.stickyTop = a.top + a.height, m.$data.$data.stickyBackTop = a.top);
                    }
                  }).exec(), m.$data.$data.scrollTop > m.$data.$data.stickyTop && wx.pageScrollTo({
                    duration: 0,
                    scrollTop: m.$data.$data.stickyTop + 4
                  }))), m.getScrollHeight(), 2 == m.pageNum && t.list.length < 10 && (console.log("load_over_goods_list_begin"),
                    m.$data.$data.loadOver = !0, m.hasRefeshin = !0, m.setData({
                    loadMore: !0
                  }, function() {
                    m.load_over_gps_goodslist();
                  }));
                }*/)
            } else {
              1 == t.code ? (m.$data.$data.loadOver = !0, m.load_over_gps_goodslist()) : 2 == t.code && (
                m.needAuth = !0,
                  m.couponRefresh = !1
              )
            }
          }
        }))
      },
      load_over_gps_goodslist: function() {

        console.log(this.$data)
        var t = wx.getStorageSync('token'),
          o = this,
          a = wx.getStorageSync('community'),
          e = o.classificationId || 0
        !o.$data.$data.hasOverGoods && o.loadOver ? (o.$data.$data.hasOverGoods = !0, (o.loadMore = !0),
          o.$http({
            controller: 'index.load_over_gps_goodslist',
            token: t,
            pageNum: o.$data.$data.overPageNum,
            head_id: a.communityId,
            gid: e,
            is_index_show: 1
          }).then(t => {
            if (0 == t.code) {
              var a = o.transTime(t.list)
              for (var e in o.$data.$data.countDownMap) countDownInit.initCountDown(o.$data.$data.countDownMap[e])
              o.$data.$data.hasOverGoods = !1, o.$data.$data.overPageNum += 1, (
                o.rushList = a,
                  o.loadMore = !1,
                  o.tip = ''
                  , function() {
                  1 == o.isFirst && (o.isFirst++, a.length && !o.$data.$data.stickyTop && (wx.createSelectorQuery().select('.tab-nav-index-query').boundingClientRect(function(t) {
                    if (t && t.top) {
                      wcache.put('tabPos', t), o.$data.$data.stickyTop = t.top + t.height, o.$data.$data.stickyBackTop = t.top
                    } else {
                      var a = wcache.get('tabPos', !1)
                      a && (o.$data.$data.stickyTop = a.top + a.height, o.$data.$data.stickyBackTop = a.top)
                    }
                  }).exec(), o.$data.$data.scrollTop > o.$data.$data.stickyTop && wx.pageScrollTo({
                    duration: 0,
                    scrollTop: o.$data.$data.stickyTop + 4
                  }))), o.getScrollHeight()
                })
            } else {
              if (1 == t.code) {
                if (1 == o.$data.$data.overPageNum && 0 == o.rushList.length) {
                  o.showEmpty = !0
                  o.loadMore = !1
                  o.tip = 'Please try again'
                }
              } else if (2 == t.code) {
                o.needAuth = !0,
                  o.couponRefresh = !1
              }
            }
            o.$data.$data.isLoadData = !1

          })) : o.$data.$data.isLoadData = !1

        if (1 == o.$data.$data.overPageNum && 0 == o.rushList.length) {
          o.showEmpty = !0
          o.loadMore = !1
          o.tip = 'Please try again'
        } else {
          o.showEmpty = !1
          o.loadMore = !1
        }
      },
      transTime: function(t) {
        var a = this
        return 0 == (1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0) && t.map(function(t) {
          t.end_time *= 1e3, a.$data.$data.countDownMap[t.end_time] = t.end_time == 0 ? '' : t.end_time, a.$data.$data.actEndMap[t.end_time] = (t.end_time <= new Date().getTime() && t.end_time != 0) || 0 == t.spuCanBuyNum

        }), a.rushList.concat(t)

      }
      ,
      fliterCommunity: function(t) {
        if (t && t.fullAddress && t.fullAddress.indexOf('境外') > -1) {
          t.fullAddress = t.fullAddress.replace('境外境外境外地区', '')
        }
        var a = t && t.fullAddress && t.fullAddress.split('省')
        console.log(a, 'fsdfs')
        return a ? Object.assign({}, t, {
          address: a[1] || a[0]
        }) : t
      }
      ,
      getNavigat() {
        this.$http({
          controller: 'index.get_navigat_h5'
        }).then(response => {

          var a = response.data || [],
            e = []
          if (0 < a.length) {
            var o = 4 - a.length % 4 || 0
            o < 4 && 0 < o && (e = new Array(o))
          }

          this.navigat = a
          this.navigatEmpty = e

        })
      },

      tabSwitch: function(e) {
        var a = this;
        this.tabIdx = e;
        1 == e && (a.$data.$data.stickyFlag && a.$data.$data.scrollTop != a.$data.$data.stickyTop + 5 && wx.pageScrollTo({
          scrollTop: a.$data.$data.stickyTop + 5,
          duration: 0
        }), 1 == a.tpage && a.getCommingList())
      }
      ,
      handleProxy: function() {
        clearTimeout(timerOut)
        this.isTipShow = !1
        this.isShowGuide = !0
        wcache.put('inNum', 4)
      },
      handleHideProxy: function() {
        this.isTipShow = !1
        this.isShowGuide = !1
      },
      getCommunityPos: function(t) {
        var a = this
        a.$http({
          controller: 'index.get_community_position',
          communityId: t
        }).then(t => {
          0 == t.code && (a.postion = t.postion)
        })
      },
      gotoMap: function() {
        var t = this.community
        console.log(t.communityId)
        this.$http({
          controller: 'index.get_community_position',
          communityId: t.communityId
        }).then(t => {
          var a = t.postion
          var e = parseFloat(a.lon)
          var o = parseFloat(a.lat)
          var i = t.disUserName
          var s = t.fullAddress + '(' + t.communityName + ')'
          wx.openLocation({
            latitude: o,
            longitude: e,
            name: i,
            address: s,
            scale: 28
          })

        })
      },
      goOrder: function() {

        var i = this
        i.can_car && (i.can_car = !1)
        wx.getStorageSync('token')
        var t = wx.getStorageSync('community'),
          a = i.addCar_goodsid,
          e = t.communityId,
          o = i.sku_val,
          s = i.cur_sku_arr,
          n = ''
        s && s.option_item_ids && (n = s.option_item_ids)
        var d = {
          goods_id: a,
          community_id: e,
          quantity: o,
          sku_str: n,
          buy_type: 'dan',
          pin_id: 0,
          is_just_addcar: i.is_presell ? 0 : 1
        }
        util.addCart(d).then(function(t) {
          if (1 == t.showVipModal) {
            var a = t.pop_vipmember_buyimage
            wx.hideLoading(), (i.pop_vipmember_buyimage = a, i.showVipModal = !0, i.visible = !1)
          } else if (3 == t.code || 7 == t.code) {
            wx.showToast({
              title: t.msg,
              icon: 'none',
              duration: 2e3
            })
          } else if (4 == t.code) {
            wx.hideLoading(), (i.needAuth = !0, i.showAuthModal = !0, i.visible = !1)
          } else if (6 == t.code) {
            var e = t.max_quantity || ''
            if (0 < e) {
              i.sku_val = e
            }
            var o = t.msg
            wx.showToast({
              title: o,
              icon: 'none',
              duration: 2e3
            })
          } else if(t.code ==1 && i.is_presell){
            var s = t.is_limit_distance_buy

            i.$wx.navigateTo({
              url: '/ulink_comshop/pages/order/placeOrder?type=dan&is_limit=' + s
            })
          } else {
            i.cartNum = t.total
            i.closeSku()
            wx.showToast({
              title: i.$t('cart.yijiarugouwuche'),
              image: '@/assets/images/addShopCart.png'
            })
          }
        }).catch(function(t) {
          //util.message(t || this.$t('cart.qingqiushibai'), '', 'error')
        })
      },
      vipModal: function(t) {

        this.setData(t)
      },
      gocarfrom: function(t) {
        this.is_take_vipcard = '', this.is_mb_level_buy = ''
        a.collectFormIds(t.formId), this.goOrder()
      },

      openSku: function(t) {
        if (this.authModal()) {
          var a = t,
            e = a.actId,
            o = a.skuList
          this.addCar_goodsid = e

          var i = o.list || [],
            s = []
          if (0 < i.length || a.isPresell) {
            for (var n = 0; n < i.length; n++) {
              var d = i[n].option_value[0],
                c = {
                  name: d.name,
                  id: d.option_value_id,
                  index: n,
                  idx: 0
                }
              s.push(c)
            }
            for (var l = '', r = 0; r < s.length; r++) r == s.length - 1 ? l += s[r].id : l = l + s[r].id + '_'
            var u;
            if(o && o.sku_mu_list){
              u = o.sku_mu_list[l] ;
            }else{
              var h = a.allData
              u = {
                canBuyNum: h.canBuyNum,
                spuName: h.spuName,
                actPrice: h.actPrice,
                marketPrice: h.marketPrice,
                stock: h.stock,
                skuImage: h.skuImage
              }
            }

            this.sku = s
            this.sku_val = 1
            this.cur_sku_arr = u
            this.skuList = a.skuList
            this.visible = true
            this.showSku = true
            this.is_presell = a.isPresell || false
            this.is_take_vipcard = a.is_take_vipcard || ''
            this.is_mb_level_buy = a.is_mb_level_buy || ''
            return true
          } else {
            var h = a.allData

            this.sku = []
            this.sku_val = 1
            this.skuList = []
            this.cur_sku_arr = h

            var m = {
              detail: {
                formId: ''
              }
            }
            m.detail.formId = 'the formId is a mock one', this.gocarfrom(m)
          }
        }
      },
      closeSku: function() {
        this.visible = 0
        this.stopClick = !1
      },
      selectSku: function(t) {
        var a = t.currentTarget.dataset.type.split('_'),
          e = this,
          o = e.sku,
          i = e.skuList,
          s = e.sku_val,
          n = {
            name: a[3],
            id: a[2],
            index: a[0],
            idx: a[1]
          }
        o.splice(a[0], 1, n)
        for (var d = '', c = 0; c < o.length; c++) c == o.length - 1 ? d += o[c].id : d = d + o[c].id + '_'
        var l = i.sku_mu_list[d],
          r = {};
        (s = s || 1) > l.canBuyNum && (e.sku_val = l.canBuyNum, wx.showToast({
          title: '最多只能购买' + l.canBuyNum + e.$t('order.meidanxiangou3'),
          icon: 'none'
        })), (e.cur_sku_arr = l, e.sku = o), console.log(d)
      },
      setNum: function(t) {
        var a = t.currentTarget.dataset.type,
          e = 1,
          o = 1 * this.sku_val
        'add' == a ? e = o + 1 : 'decrease' == a && 1 < o && (e = o - 1)
        var i = this.sku,
          s = this.skuList
        if (0 < i.length) {
          for (var n = '', d = 0; d < i.length; d++) d == i.length - 1 ? n += i[d].id : n = n + i[d].id + '_'
        }
        0 < s.length ? e > s.sku_mu_list[n].canBuyNum && (e -= 1) : e > this.cur_sku_arr.canBuyNum && (e -= 1)
        this.sku_val = e
      },
      skuConfirm: function() {
        this.closeSku(), (0, status.cartNum)().then(function(t) {
          0 == t.code && (this.cartNum = t.data)
        })
      },
      goLink: function(t) {
        var a = t.currentTarget.dataset.link,
          e = t.currentTarget.dataset.needauth || ''
        console.log(e), e && !this.authModal() || a && wx.navigateTo({
          url: a
        })
      },
      authSuccess: function() {
        console.log('authSuccess')
        var a = this
        this.tpage = 1
        this.hasRefeshin = !1
        a.rushList = [],
          a.pageNum = 1,
          a.needAuth = !1,
          a.newComerRefresh = !1,
          a.couponRefresh = !0,
          a.isblack = a.$app.globalData.isblack || 0

        a.$set(a.$data.$data, 'overPageNum', 1)
        a.$set(a.$data.$data, 'loadOver', !1)
        a.$set(a.$data.$data, 'hasOverGoods', !1)
        a.$set(a.$data.$data, 'countDownMap', {})
        a.$set(a.$data.$data, 'actEndMap', {})
        a.$set(a.$data.$data, 'timer', {})
        a.$set(a.$data.$data, 'stickyFlag', !1)
        a.$set(a.$data.$data, 'hasCommingGoods', !0)

        status.getInNum().then(function(t) {
          t /*&& (a.setData({
            isTipShow: !0
          }), timerOut = setTimeout(function() {
            a.setData({
              isTipShow: !1
            });
          }, 7e3));*/
        })
        this.loadPage(), this.isTipShow /*&& (timerOut = setTimeout(function() {
          a.setData({
            isTipShow: !1
          });
        }, 7e3));*/
      },
      authModal: function() {
        var i = this
        if (i.needAuth) {
          wx.navigateTo({
            url: '/login'
          })

          return false
        } else {
          return !i.needAuth
        }

      },
      goNavUrl: function(t) {
          debugger
        var a = t.currentTarget.dataset.idx,
          e = this,
          o = e.navigat,
          i = e.needAuth
        if (0 < o.length) {
          var s = o[a].link,
            n = o[a].type
          if (util.checkRedirectTo(s, i)) return void this.authModal()
          if (0 == n) {
            wx.navigateTo({
              url: '/ulink_comshop/pages/web-div?url=' + encodeURIComponent(s)
            })
          } else if (1 == n) {
            -1 != s.indexOf('ulink_comshop/pages/index/index') || -1 != s.indexOf('ulink_comshop/pages/order/shopCart') || -1 != s.indexOf('ulink_comshop/pages/user/me') || -1 != s.indexOf('ulink_comshop/pages/type/index') ? wx.navigateTo({
              url: s
            }) : wx.navigateTo({
              url: s
            })
          } else if (2 == n) {
            o[a].appid && wx.navigateToMiniProgram({
              appId: o[a].appid,
              path: s,
              extraData: {},
              envVersion: 'release',
              success: function(t) {
              },
              fail: function(t) {
                console.log(t)
              }
            })
          } else if (3 == n) {
            var d = this.classification,
              c = d && d.tabs,
              l = s,
              r = c.findIndex(function(t) {
                return t.id == l
              })
            if (-1 != r) {
              var u = {
                detail: {
                  e: r,
                  a: l
                }
              }
              this.classificationChange(u)
            }
          } else {
            4 == n && (this.$getApp().globalData.typeCateId = s, wx.switchTab({
              url: '/ulink_comshop/pages/type/index'
            }))
          }
        }

      },
      goCube: function(t) {
        var a = t.currentTarget.dataset.idx,
          e = t.currentTarget.dataset.index,
          o = this,
          i = o.cube,
          s = o.needAuth
        if (console.log(i), 0 < i.length) {
          var n = i[e].thumb.link[a],
            d = i[e].thumb.linktype && i[e].thumb.linktype[a]
          if (void 0 == d && (d = 1), util.checkRedirectTo(n, s)) return void this.authModal()
          if (0 == d) {
            n = i[e].thumb.webview[a], wx.blankTo({
              url: n
            })
          } else if (1 == d) {
            -1 != n.indexOf('ulink_comshop/pages/index/index') || -1 != n.indexOf('ulink_comshop/pages/order/shopCart') || -1 != n.indexOf('ulink_comshop/pages/user/me') || -1 != n.indexOf('ulink_comshop/pages/type/index') ? n && wx.switchTab({
              url: n
            }) : n && wx.navigateTo({
              url: n
            })
          } else if (2 == d) {
            navigat[a].appid && wx.navigateToMiniProgram({
              appId: navigat[a].appid,
              path: n,
              extraData: {},
              envVersion: 'release',
              success: function(t) {
              },
              fail: function(t) {
                console.log(t)
              }
            })
          } else if (3 == d) {
            var c = this.classification,
              l = c && c.tabs,
              r = n,
              u = l.findIndex(function(t) {
                return t.id == r
              })
            if (-1 != u) {
              var h = {
                detail: {
                  e: u,
                  a: r
                }
              }
              this.classificationChange(h)
            }
          } else {
            4 == d && (app.globalData.typeCateId = n, wx.switchTab({
              url: '/ulink_comshop/pages/type/index'
            }))
          }
        }
      },
      classificationChange: function(t) {

        var a = this
        a.$set(a.$data.$data, 'overPageNum', 1)
        a.$set(a.$data.$data, 'loadOver', !1)
        a.$set(a.$data.$data, 'hasOverGoods', !1)
        a.$set(a.$data.$data, 'countDownMap', {})
        a.$set(a.$data.$data, 'actEndMap', {})
        a.$set(a.$data.$data, 'timer', {})

        this.hasRefeshin = !1
        this.rushList = []
        this.showEmpty = !1,
          this.pageNum = 1,
          //this.classification.activeIndex = t.e
          //this.classificationId = t.a

          this.classificationId = this.classification.tabs[this.classification.activeIndex].id
        a.$data.$data.stickyFlag || a.$data.$data.scrollTop == a.$data.$data.stickyTop + 5 || wx.pageScrollTo({
          scrollTop: a.$data.$data.stickyTop - 100,
          duration: 0
        })
        a.load_goods_data()
      },
      commingClassificationChange: function(t) {
        var a = this
        a.tpage = 1
        a.$set(a.$data.$data, 'hasCommingGoods', !0)
        this.showCommingEmpty = !1
        this.commingList = []
       // this.commingClassification.activeIndex = t.e
       // this.commingClassificationId = t.a
        this.commingClassificationId = this.classification.tabs[this.commingClassification.activeIndex].id

        a.$data.$data.stickyFlag && a.$data.$data.scrollTop != a.$data.$data.stickyTop + 5 && wx.pageScrollTo({
          scrollTop: a.$data.$data.stickyTop + 5,
          duration: 0
        })
        a.getCommingList()
      },
      getCommingList: function() {
        var e = this
        this.commigLoadMore && wx.showLoading()
        var t = wx.getStorageSync('token'),

          a = wx.getStorageSync('community'),
          o = this.commingClassificationId || 0
        e.$data.$data.isLoadData = !0, e.$data.$data.hasCommingGoods ? (
          e.$set(e.$data.$data, 'hasCommingGoods', !1),
            e.commigLoadMore = !0,
            app.util.request({
              url: 'entry/wxapp/index',
              data: {
                controller: 'index.load_comming_goodslist',
                token: t,
                pageNum: e.tpage,
                head_id: a.communityId,
                gid: o
              },
              dataType: 'json',
              success: function(t) {
                if (wx.hideLoading(), 0 == t.code) {
                  var a = t.list
                  a = e.commingList.concat(a), e.$data.$data.hasCommingGoods = !0, e.tpage += 1, (
                    e.commingList = a,
                      e.commigLoadMore = !1,
                      e.commigTip = ''
                  )
                } else {
                  1 == t.code ? (1 == e.tpage && 0 == e.commingList.length && (
                    e.showCommingEmpty = !0
                  ), (
                    e.commigLoadMore = !1,
                      e.commigTip = '^_^已经到底了'
                  )) : 2 == t.code && (
                    e.needAuth = !0,
                      e.couponRefresh = !1
                  )
                }
                e.$data.$data.isLoadData = !1
              }
            })) : (e.$data.$data.isLoadData = !1, !e.data.commigLoadMore && wx.hideLoading())
      },
      getHistoryCommunity: function() {
        var d = this,
          c = wx.getStorageSync('token')

        this.$http({
          controller: 'index.load_history_community',
          token: c
        }).then(t => {
          if (console.log('step14'), 0 == t.code) {
            console.log('getHistoryCommunity')
            var a = t.list,
              e = !1
            0 != Object.keys(a).length && 0 != a.communityId || (e = !0)
            var o = a && a.fullAddress && a.fullAddress.split('省')
            if (a = Object.assign({}, a, {address: o[1]}), d.community = a, wx.setStorageSync('community', a), d.$getApp().globalData.community = a, c && !e) {
              var i = wx.getStorageSync('lastCommunity'),
                s = i.communityId || ''
              '' != s && s != a.communityId && (
                d.showChangeCommunity = !0,
                  d.changeCommunity = i,
                  wx.removeStorageSync('lastCommunity')
              )
            }
            (d.community = d.$getApp().globalData.community), d.load_goods_data()
          } else {
            var n = d.options
            void 0 !== n && n.community_id ? (console.log('新人加入分享进来的社区id:', d.options), d.addhistory(n.community_id)) : 1 == t.code ? (console.log('获取历史社区'),
              wx.redirectTo({
                url: '/ulink_comshop/pages/position/community'
              })) : (d.needAuth = !0)
          }
        })
      },
      changeNotListCartNum: function(t) {
        var a = t
        status.cartNum().then(function(e) {
          this.cartNum = e.data
        })
        this.changeRushListNum()
      },
      changeCartNum: function(t) {
        var a = t
        this.cartNum = a
      },
      changeRushListNum: function() {
        var t = this.$getApp().globalData.goodsListCarCount,
          o = this.rushList,
          i = !1;
        (this.changeCarCount = i), 0 < t.length && 0 < o.length && (t.forEach(function(a) {
          var t = o.findIndex(function(t) {
            return t.actId == a.actId
          })
          if (-1 != t && 0 == o[t].skuList.length) {
            var e = 1 * a.num
            o[t].car_count = 0 <= e ? e : 0, i = !0
          }
        }), (
          this.rushList = o,
            this.changeCarCount = i
        ))
      },
      share_handler: function() {
        this.is_share_html = true
        //location="whatsapp://send?text="+ encodeURIComponent('分享的内容') + encodeURIComponent("\n\n"+'https://hz.xx315.net/wap')+"&via=lopscoop";
      },
      share_whatsapp: function() {

         let token = wx.getStorageSync('token');
         let url = encodeURIComponent(window.location.href);
         let that = this;

          app.util.request({
              url: "entry/wxapp/user",
              data: {
                  controller: "index.get_share_url",
                  url:url,
                  token: token
              },
              dataType: "json",
              success: function(t) {

                  location  =  'whatsapp://send?text=' + encodeURIComponent(that.shop_info.title) + encodeURIComponent('\n\n' +  t.url)

              }
          });
          this.is_share_html = false

      },
      confrimChangeCommunity: function() {
        var t = this,
          a = t.changeCommunity
        t.$app.globalData.community = a, wcache.put('community', a)
        console.log(t.$data.$data)

        t.$set(t.$data.$data, 'overPageNum', 1)
        t.$set(t.$data.$data, 'loadOver', !1)
        t.$set(t.$data.$data, 'hasOverGoods', !1)
        t.$set(t.$data.$data, 'countDownMap', {})
        t.$set(t.$data.$data, 'actEndMap', {})
        t.$set(t.$data.$data, 'timer', {})
        t.$set(t.$data.$data, 'stickyFlag', !1)

        this.hasRefeshin = !1,
          t.showChangeCommunity = !1,
          t.community = a,
          t.rushList = [],
          t.pageNum = 1
        t.loadPage()
        t.addhistory()
      },
      showCopyTextHandle: function(t) {

        if (this.authModal()) {
          var a = t.target.dataset.status
          this.showCopyText = a
        }
      },
      changeSecKillTime: function(t) {
        var a = this,
          e = t.target.dataset.time,
          o = t.target.dataset.idx

        this.secRushList = [],
          this.secKillActiveIdx = o
        a.getSecKillGoods(e)
      },
      goResult: function(t) {

        if (event.keyCode == 13) { //如果按的是enter键 13是enter
          event.preventDefault() //禁止默认事件（默认是换行）
          //var a = t.currentTarget.value.replace(/\s+/g, "");
          var a = t.currentTarget.value
          a ? wx.navigateTo({
            url: '/ulink_comshop/pages/type/result?keyword=' + a
          }) : wx.showToast({
            title: '请输入关键词',
            icon: 'none'
          })
        }
      },
      clearSearch: function(t) {
        this.searchName = ''
      },
      receiveCoupon: function(t) {
        if (this.authModal()) {
          var o = t.currentTarget.dataset.quan_id,
            i = t.currentTarget.dataset.type || 0,
            a = wx.getStorageSync('token'),
            s = []
          s = 1 == i ? this.alert_quan_list : this.quan
          var n = this
          app.util.request({
            url: 'entry/wxapp/index',
            data: {
              controller: 'goods.getQuan',
              token: a,
              quan_id: o
            },
            dataType: 'json',
            success: function(t) {
              if (0 == t.code) {
                wx.showToast({
                  title: t.msg || '被抢光了',
                  icon: 'none'
                })
              } else if (1 == t.code) {
                wx.showToast({
                  title: '被抢光了',
                  icon: 'none'
                })
              } else if (2 == t.code) {
                wx.showToast({
                  title: '已领取',
                  icon: 'none'
                })
                var a = []
                for (var e in s) s[e].id == o && (s[e].is_get = 1), a.push(s[e])
                n.quan = a
              } else if (4 == t.code) {
                wx.showToast({
                  title: '新人专享',
                  icon: 'none'
                })
              } else if (3 == t.code) {
                a = []
                for (var e in s) s[e].id == o && (s[e].is_get = 1), a.push(s[e])
                1 == i ? (
                  n.alert_quan_list = a
                ) : (
                  n.quan = a
                ), wx.showToast({
                  title: '领取成功'
                })
              } else {
                t.code
              }
            }
          })
        }
      },

      swiperClick: function(item) {
        this.$router.push(item.link)
      },
      backTop: function() {

      },

      getSupplyList: function() {
        var token = wx.getStorageSync('token');
        var that = this;
        var cur_community = wx.getStorageSync('community');
        var latitude = wx.getStorageSync('latitude');
        var longitude = wx.getStorageSync('longitude');
        if (!latitude || !longitude) {
          latitude =  1.3677037;
          longitude = 103.8542143;
        }
        app.util.request({
          'url': 'entry/wxapp/index',
          'data': {
            controller: 'supply.get_list',
            token: token,
            page: 1,
            head_id: cur_community.communityId,
            lat: latitude,
            lon: longitude
          },
          dataType: 'json',
            method:'post',
          success: function (res) {
            if (res.code == 0) {
              let supply = [];
              let supply_list = res.data;
              let length = supply_list.length >= 8 ? 8 : supply_list.length;
              if (supply_list.length != length) {
                for(var i=0;i<length;i++) {
                  let distance = supply_list[i].distance;
                  if (distance) {
                    supply_list[i].distance = (distance/1000).toFixed(1);
                  }
                  supply.push(supply_list[i]);
                }
              } else {
                for(var i=0;i<length;i++) {
                  let distance = supply_list[i].distance;
                  if (distance) {
                    supply_list[i].distance = (distance/1000).toFixed(1);
                  }
                }
                supply = supply_list;
              }
              that.supply = supply;
            }
          }
        })
      },

      goSupply: function (event) {
        var id = event.currentTarget.dataset.id;
        wx.navigateTo({
          url: '/ulink_comshop/pages/supply/supplyHome?id=' + id
        })
      },

      getCopyright: function() {
        let that = this;
        app.util.request({
          'url': 'entry/wxapp/user',
          'data': {
            controller: 'user.get_copyright'
          },
          dataType: 'json',
          success: function(res) {
            if (res.code == 0) {
              let enabledFrontSupply = res.enabled_front_supply;
              that.enabledFrontSupply = enabledFrontSupply;
            }
          }
        })
      },
    }
  }

</script>

<style src="@/ulink_comshop/pages/index/index.css" >
</style>
<style src="@/ulink_comshop/pages/index/cube.css">
</style>
<style src="@/ulink_comshop/pages/index/seckill.css">
</style>

<style scoped>
/* 店铺 */
.index_supply {
  width: 95%;
  border-radius: 2vw;
  margin: 2vw auto;
  background: #fff;
  box-shadow: 0 0 4vw rgba(0, 0, 0, 0.1);
  padding: 2vw 0;
}

.modal-head {
  position: relative;
  padding: 2vw 3vw;
}

.modal-head::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  height: 1px;
  transform: scaleY(.5);
}

.modal-head::after {
  border-bottom: 1px solid #c8c7cc;
  bottom: 0;
}

.index_supply .my-supply  {
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
  margin-bottom: 10px;
  font-size: 15px;
  font-weight: bold;
  color: #333;
  padding-left: 10px;
  height: 34px;
}

.index_supply .my-supply .my-supply-title {
  flex: 1;
  font-weight: 500;
  color: #444;
}

.index_supply .my-supply .to-supply {
  font-size: 2.4vw;
  color: #aaa;
  margin-right: 2vw;
}

.icon-right {
  width: 1.2vw;
  height: 2.2vw;
  margin-left: 2vw;
}

.supply-list {
  position: relative;
  z-index: 1;
  margin: 3vw 0 1vw;
  display: flex;
  padding: 0 2vw;
  flex-wrap: wrap;
  justify-content: space-between;
}

.supply-list-item {
  width: 25%;
  color: #333;
  margin-bottom: 2vw;
}

.supply-list-item .supply-list-img  {
  display: block;
  width: 10vw;
  height: 10vw;
  margin: 0 auto;
  border-radius: 5px;
}

.supply-list-item .supply-list-distance {
  text-align: right;
  font-size: 1vw;
  color: #363636;
}

.supply-list-item .supply-list-text {
  text-align: center;
  font-size: 3vw;
  margin: 0.8vw 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.supply-contact {
  font-size: inherit;
  line-height: inherit;
  border-radius: 0;
  background: transparent;
  color: inherit;
  padding: 0;
}

.supply-contact::after {
  content: none;
}

.supply-list-item .nav-contact .supply-list-img {
  left: 0;
}

.leftBorder {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  border-left: 4px solid #8ED9D1;
}
</style>



